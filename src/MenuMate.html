<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MenuMate - ãƒ©ãƒ³ãƒãƒ¡ãƒ‹ãƒ¥ãƒ¼ææ¡ˆã‚¢ãƒ—ãƒª</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            max-width: 400px;
            width: 100%;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #ff6b6b, #feca57);
            padding: 30px 20px;
            text-align: center;
            color: white;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 16px;
            opacity: 0.9;
        }

        .content {
            padding: 30px 20px;
        }

        .question {
            margin-bottom: 30px;
        }

        .question h3 {
            font-size: 18px;
            margin-bottom: 15px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .required {
            color: #ff6b6b;
            font-size: 12px;
            font-weight: normal;
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .choice-btn {
            flex: 1;
            padding: 15px 10px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 12px;
            cursor: pointer;
            text-align: center;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
            min-width: 100px;
        }

        .choice-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .choice-btn.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .optional-btn {
            width: 100%;
            padding: 15px;
            border: 2px dashed #e0e0e0;
            background: #f8f9fa;
            border-radius: 12px;
            cursor: pointer;
            text-align: center;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .optional-btn:hover {
            background: #fff3cd;
            border-color: #feca57;
        }

        .optional-btn.selected {
            background: #feca57;
            color: white;
            border-color: #feca57;
        }

        .submit-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .submit-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .result {
            display: none;
        }

        .result-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            border: 2px solid #e9ecef;
        }

        .result-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .result-header h3 {
            color: #333;
            font-size: 20px;
            margin-bottom: 10px;
        }

        .menu-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .menu-item:last-child {
            border-bottom: none;
            font-weight: bold;
            font-size: 18px;
            color: #667eea;
            margin-top: 10px;
            padding-top: 15px;
            border-top: 2px solid #667eea;
        }

        .menu-name {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
        }

        .menu-price {
            font-weight: bold;
            color: #333;
        }

        .comment {
            background: #fff3cd;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            border-left: 4px solid #feca57;
        }

        .comment p {
            color: #333;
            font-size: 16px;
            line-height: 1.5;
        }

        .crowd-question {
            text-align: center;
            margin: 25px 0;
        }

        .crowd-question h4 {
            margin-bottom: 15px;
            color: #333;
        }

        .crowd-buttons {
            display: flex;
            gap: 15px;
        }

        .crowd-btn {
            flex: 1;
            padding: 15px 10px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 12px;
            cursor: pointer;
            text-align: center;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .crowd-btn.empty {
            border-color: #28a745;
            color: #28a745;
        }

        .crowd-btn.crowded {
            border-color: #dc3545;
            color: #dc3545;
        }

        .crowd-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .final-btn {
            width: 100%;
            padding: 18px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 15px;
        }

        .final-btn:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .back-btn {
            width: 100%;
            padding: 15px;
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .back-btn:hover {
            background: #545b62;
        }

        @media (max-width: 480px) {
            .container {
                margin: 10px;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .choice-btn {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ½ï¸ MenuMate</h1>
            <p>ä»Šæ—¥ã®ãƒ©ãƒ³ãƒã€ä¸€ç·’ã«æ±ºã‚ã¾ã—ã‚‡ã†ï¼</p>
        </div>

        <div id="selection-screen" class="content">
            <div class="question">
                <h3>ğŸ’° ä»Šæ—¥ã®ãŠè²¡å¸ƒäº‹æƒ…ã¯ï¼Ÿ <span class="required">â€»å¿…é ˆ</span></h3>
                <div class="button-group">
                    <button class="choice-btn" data-budget="rich">å¯Œè£•<br><small>450å††ä»¥ä¸Š</small></button>
                    <button class="choice-btn" data-budget="normal">æ™®é€š<br><small>400å††ç¨‹åº¦</small></button>
                    <button class="choice-btn" data-budget="poor">é‡‘æ¬ <br><small>300å††ä»¥ä¸‹</small></button>
                </div>
            </div>

            <div class="question">
                <h3>ğŸ½ï¸ ãŠè…¹ã®èª¿å­ã¯ï¼Ÿ <span class="required">â€»å¿…é ˆ</span></h3>
                <div class="button-group">
                    <button class="choice-btn" data-hunger="hungry">ã¯ã‚‰ãºã“<br><small>ãŒã£ã¤ã‚Šç³»</small></button>
                    <button class="choice-btn" data-hunger="light">å°‘é£Ÿ<br><small>è»½ã‚ç³»</small></button>
                </div>
            </div>

            <div class="question">
                <h3>âœ¨ ä»Šæ—¥ã®æ°—åˆ†ã¯ï¼Ÿ</h3>
                <button class="optional-btn" data-mood="special">ã‚¢ã‚²ã‚¢ã‚²<br><small>ç‰¹åˆ¥æ„Ÿã‚’æ±‚ã‚ã‚‹</small></button>
            </div>

            <button id="submit-btn" class="submit-btn" disabled>ğŸ¯ ææ¡ˆã—ã¦ï¼</button>
        </div>

        <div id="result-screen" class="content result">
            <div class="result-card">
                <div class="result-header">
                    <h3>ğŸ’¡ MenuMateã‹ã‚‰ã®ææ¡ˆ</h3>
                </div>
                <div id="menu-items"></div>
            </div>

            <div class="comment">
                <p id="comment-text"></p>
            </div>

            <div class="crowd-question">
                <h4>ã€æ··é›‘çŠ¶æ³ã¯ã©ã†ã§ã™ã‹ï¼Ÿã€‘</h4>
                <div class="crowd-buttons">
                    <button class="crowd-btn empty" onclick="handleCrowdStatus('empty')">
                        ğŸŸ¢ ç©ºã„ã¦ã‚‹<br><small>éººğŸœ</small>
                    </button>
                    <button class="crowd-btn crowded" onclick="handleCrowdStatus('crowded')">
                        ğŸ”´ æ··ã‚“ã§ã‚‹<br><small>å†ææ¡ˆ</small>
                    </button>
                </div>
            </div>

            <button class="final-btn" onclick="finalDecision()">âœ… ã“ã‚Œã«æ±ºã‚ãŸï¼</button>
            <button class="back-btn" onclick="goBack()">â† æœ€åˆã‹ã‚‰é¸ã³ç›´ã™</button>
        </div>

        <div id="final-screen" class="content result">
            <div class="result-header" style="text-align: center; margin-bottom: 30px;">
                <h3>ğŸ‰ æ±ºå®šã—ã¾ã—ãŸï¼</h3>
                <p style="margin-top: 10px; color: #666;">æœ€é«˜ã®ãƒ©ãƒ³ãƒã‚¿ã‚¤ãƒ ã‚’ãŠéã”ã—ãã ã•ã„</p>
            </div>
            
            <div class="result-card">
                <div class="result-header">
                    <h3>ğŸ“‹ é¸æŠã•ã‚ŒãŸãƒ¡ãƒ‹ãƒ¥ãƒ¼</h3>
                </div>
                <div id="final-menu-items"></div>
            </div>

            <div class="comment">
                <p id="final-comment-text"></p>
            </div>
            
            <button class="back-btn" onclick="restart()">â† æ–°ã—ãé¸ã¶</button>
        </div>
    </div>

    <script src="menuDatabase.js"></script>
    <script>

        // é¸æŠçŠ¶æ…‹
        let selections = {
            budget: null,
            hunger: null,
            mood: null
        };

        let currentSuggestion = null;

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
        });

        function setupEventListeners() {
            // é¸æŠãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆ
            document.querySelectorAll('.choice-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const type = this.dataset.budget || this.dataset.hunger;
                    const category = this.dataset.budget ? 'budget' : 'hunger';
                    
                    // åŒã˜ã‚«ãƒ†ã‚´ãƒªã®ä»–ã®ãƒœã‚¿ãƒ³ã®é¸æŠã‚’è§£é™¤
                    document.querySelectorAll(`[data-${category}]`).forEach(b => b.classList.remove('selected'));
                    
                    this.classList.add('selected');
                    selections[category] = type;
                    
                    checkSubmitButton();
                });
            });

            // æ°—åˆ†ãƒœã‚¿ãƒ³ï¼ˆä»»æ„ï¼‰
            document.querySelector('.optional-btn').addEventListener('click', function() {
                this.classList.toggle('selected');
                selections.mood = this.classList.contains('selected') ? this.dataset.mood : null;
            });

            // ææ¡ˆãƒœã‚¿ãƒ³
            document.getElementById('submit-btn').addEventListener('click', function() {
                generateSuggestion();
            });
        }

        function checkSubmitButton() {
            const submitBtn = document.getElementById('submit-btn');
            if (selections.budget && selections.hunger) {
                submitBtn.disabled = false;
            } else {
                submitBtn.disabled = true;
            }
        }

        function generateSuggestion(avoidCrowded = false, prioritizeRamen = false) {
            const suggestion = createSuggestion(selections, avoidCrowded, prioritizeRamen);
            currentSuggestion = suggestion;
            displaySuggestion(suggestion);
            showResultScreen();
        }

        function createSuggestion(selections, avoidCrowded = false, prioritizeRamen = false) {
            const budget = getBudgetRange(selections.budget);
            const isHungry = selections.hunger === 'hungry';
            const isSpecial = selections.mood === 'special';
            
            let availableItems = [...menuDatabase.main];
            
            // æ··é›‘å›é¿
            if (avoidCrowded) {
                availableItems = availableItems.filter(item => !item.crowded);
            }
            
            // ç©ºã„ã¦ã„ã‚‹å ´åˆã¯ãƒ©ãƒ¼ãƒ¡ãƒ³ã‚’å„ªå…ˆ
            if (prioritizeRamen) {
                const ramenItems = availableItems.filter(item => item.category === 'noodle');
                const otherItems = availableItems.filter(item => item.category !== 'noodle');
                availableItems = [...ramenItems, ...otherItems];
            }
            
            let suggestions = [];
            
            // äºˆç®—ã«å¿œã˜ãŸææ¡ˆç”Ÿæˆ
            for (let attempt = 0; attempt < 50; attempt++) {
                const suggestion = generateRandomCombination(availableItems, budget, isHungry, isSpecial, prioritizeRamen);
                if (suggestion && suggestion.total <= budget.max) {
                    suggestions.push(suggestion);
                    if (suggestions.length >= 2) break;
                }
            }
            
            // æœ€é©ãªææ¡ˆã‚’é¸æŠ
            if (suggestions.length > 0) {
                return suggestions[Math.floor(Math.random() * Math.min(suggestions.length, 2))];
            }
            
            // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
            return createFallbackSuggestion(budget);
        }

        function generateRandomCombination(availableItems, budget, isHungry, isSpecial, prioritizeRamen = false) {
            let items = [];
            let total = 0;
            
            // ç‰¹åˆ¥æ„Ÿã‚’æ±‚ã‚ã‚‹å ´åˆã¯ã‚¹ãƒšã‚·ãƒ£ãƒ«ãƒ¡ãƒ‹ãƒ¥ãƒ¼å„ªå…ˆ
            if (isSpecial) {
                availableItems = [...availableItems.filter(item => item.name.includes('ã‚¹ãƒšã‚·ãƒ£ãƒ«')), ...availableItems];
            }
            
            // ãƒ©ãƒ¼ãƒ¡ãƒ³å„ªå…ˆã®å ´åˆã¯éººé¡ã‚’æœ€å„ªå…ˆ
            if (prioritizeRamen) {
                availableItems = [...availableItems.filter(item => item.category === 'noodle'), ...availableItems];
            }
            
            // äºˆç®—ã¨é£Ÿæ¬²ã«åŸºã¥ãå“æ•°æ±ºå®š
            const budgetType = selections.budget;
            const hungerType = selections.hunger;
            let targetItemCount = 2; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
            
            if (budgetType === 'poor' && hungerType === 'light') {
                // é‡‘æ¬ ï¼‹å°‘é£Ÿï¼š290å††ä»¥å†…ã§2å“ç›®
                targetItemCount = 2;
                budget.max = Math.min(budget.max, 290);
            } else if (budgetType === 'normal' && hungerType === 'light') {
                // æ™®é€šï¼‹å°‘é£Ÿï¼š380å††ç¨‹åº¦ã§å‘³å™Œæ±ã‚’å«ã‚€3å“ç›®
                targetItemCount = 3;
                budget.max = Math.min(budget.max, 380);
            } else if (budgetType === 'normal' && hungerType === 'hungry') {
                // æ™®é€šï¼‹ã¯ã‚‰ãºã“ï¼š4å“ç›®
                targetItemCount = 4;
            } else if (budgetType === 'rich' && hungerType === 'hungry') {
                // å¯Œè£•ï¼‹ã¯ã‚‰ãºã“ï¼š5å“ç›®
                targetItemCount = 5;
            }
            
            // ã‚¢ã‚²ã‚¢ã‚²ã®å ´åˆã¯ãƒ‡ã‚¶ãƒ¼ãƒˆã‚’ãƒ—ãƒ©ã‚¹
            if (isSpecial) {
                targetItemCount += 1;
            }
            
            // ãƒ¡ã‚¤ãƒ³ã‚¢ã‚¤ãƒ†ãƒ ã‚’é¸æŠ
            const mainItem = availableItems[Math.floor(Math.random() * Math.min(3, availableItems.length))];
            items.push(mainItem);
            total += mainItem.price;
            
            // çµ„ã¿åˆã‚ã›åˆ¶é™ãƒã‚§ãƒƒã‚¯
            const canAddRice = !['curry', 'bowl', 'bento'].includes(mainItem.category);
            
            // å“æ•°ã«å¿œã˜ã¦ã‚¢ã‚¤ãƒ†ãƒ ã‚’è¿½åŠ 
            let attempts = 0;
            while (items.length < targetItemCount && attempts < 20) {
                attempts++;
                
                // å“æ•°ã«å¿œã˜ãŸå„ªå…ˆé †ä½
                if (items.length === 1 && canAddRice) {
                    // 2å“ç›®ï¼šã”é£¯ã‚’å„ªå…ˆ
                    const riceOptions = isHungry ? 
                        menuDatabase.rice.filter(r => r.name.includes('å¤§') || r.name.includes('ä¸­')) :
                        menuDatabase.rice.filter(r => !r.name.includes('å¤§'));
                    
                    if (riceOptions.length > 0) {
                        const rice = riceOptions[Math.floor(Math.random() * riceOptions.length)];
                        if (total + rice.price <= budget.max) {
                            items.push(rice);
                            total += rice.price;
                            continue;
                        }
                    }
                }
                
                if (items.length === 2 && (budgetType === 'normal' && hungerType === 'light')) {
                    // æ™®é€šï¼‹å°‘é£Ÿã®3å“ç›®ï¼šå‘³å™Œæ±ã‚’å¿…é ˆã§è¿½åŠ 
                    const misoSoup = menuDatabase.side.find(side => side.name === 'å‘³å™Œæ±');
                    if (misoSoup && total + misoSoup.price <= budget.max) {
                        items.push(misoSoup);
                        total += misoSoup.price;
                        continue;
                    }
                }
                
                // ã‚¢ã‚²ã‚¢ã‚²ã®å ´åˆã€æœ€å¾Œã«ãƒ‡ã‚¶ãƒ¼ãƒˆã‚’è¿½åŠ 
                if (isSpecial && items.length === targetItemCount - 1) {
                    const dessert = menuDatabase.side.find(side => side.category === 'dessert');
                    if (dessert && total + dessert.price <= budget.max) {
                        items.push(dessert);
                        total += dessert.price;
                        continue;
                    }
                }
                
                // ãã®ä»–ã®ã‚µã‚¤ãƒ‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¿½åŠ 
                const affordableSides = menuDatabase.side.filter(side => 
                    total + side.price <= budget.max && 
                    !items.some(item => item.name === side.name)
                );
                
                if (affordableSides.length > 0) {
                    const side = affordableSides[Math.floor(Math.random() * affordableSides.length)];
                    items.push(side);
                    total += side.price;
                } else {
                    break; // äºˆç®—å†…ã§è¿½åŠ ã§ãã‚‹ã‚¢ã‚¤ãƒ†ãƒ ãŒãªã„
                }
            }
            
            return {
                items: items,
                total: total,
                comment: generateComment(items, selections, total, prioritizeRamen)
            };
        }

        function getBudgetRange(budget) {
            switch(budget) {
                case 'rich': return {max: 500, min: 450};
                case 'normal': return {max: 450, min: 300};
                case 'poor': return {max: 300, min: 150};
                default: return {max: 400, min: 200};
            }
        }

        function generateComment(items, selections, total, prioritizeRamen = false) {
            const comments = [];
            
            // ãƒ©ãƒ¼ãƒ¡ãƒ³å„ªå…ˆæ™‚ã®ç‰¹åˆ¥ã‚³ãƒ¡ãƒ³ãƒˆ
            if (prioritizeRamen) {
                const hasRamen = items.some(item => item.category === 'noodle');
                if (hasRamen) {
                    comments.push('ä»ŠãŒãƒãƒ£ãƒ³ã‚¹ï¼ç†±ã€…éººé¡ã‚’æ¥½ã—ã‚ã¾ã™', 'ãƒ©ãƒƒã‚­ãƒ¼ï¼å¾…ã¡æ™‚é–“ãªã—ã§éººé¡ãŒé£Ÿã¹ã‚‰ã‚Œãã†', 'ç©ºã„ã¦ã‚‹ä»Šãªã‚‰éººé¡ãŒãŠã™ã™ã‚');
                }
            }
            
            if (selections.budget === 'poor') {
                comments.push('ç¯€ç´„ãƒ©ãƒ³ãƒã§ã‚‚ç¾å‘³ã—ãï¼', 'é‡‘æ¬ ã®å‘³æ–¹ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã§ã™', 'ã‚³ã‚¹ãƒ‘æœ€é«˜ã®çµ„ã¿åˆã‚ã›');
            } else if (selections.budget === 'rich') {
                comments.push('ä»Šæ—¥ã¯ã¡ã‚‡ã£ã¨è´…æ²¢ã—ã¾ã—ã‚‡ã†ï¼', 'å……å®Ÿãƒ©ãƒ³ãƒã§åˆå¾Œã‚‚é ‘å¼µã£ã¦', 'ãƒªãƒƒãƒãªãƒ©ãƒ³ãƒã‚¿ã‚¤ãƒ ');
            } else {
                comments.push('ãƒãƒ©ãƒ³ã‚¹ã®è‰¯ã„çµ„ã¿åˆã‚ã›ã§ã™', 'å®šç•ªã§é–“é•ã„ãªã—', 'æ™®é€šäºˆç®—ã§ã—ã£ã‹ã‚Šã¨');
            }
            
            if (selections.hunger === 'hungry') {
                comments.push('ãŒã£ã¤ã‚Šé£Ÿã¹ã¦å…ƒæ°—ãƒãƒ£ãƒ¼ã‚¸ï¼', 'ãƒœãƒªãƒ¥ãƒ¼ãƒ æº€ç‚¹ã§æº€è¶³åº¦â—');
            } else {
                comments.push('è»½ã‚„ã‹ãƒ©ãƒ³ãƒã§åˆå¾Œã‚‚ã™ã£ãã‚Š', 'ãƒ˜ãƒ«ã‚·ãƒ¼ã§ä½“ã«å„ªã—ã„');
            }
            
            if (selections.mood === 'special') {
                comments.push('ä»Šæ—¥ã¯ç‰¹åˆ¥ãªæ—¥ã§ã™ã­ï¼', 'ã‚¹ãƒšã‚·ãƒ£ãƒ«æ°—åˆ†ã«ã´ã£ãŸã‚Š');
            }
            
            return comments[Math.floor(Math.random() * comments.length)];
        }

        function createFallbackSuggestion(budget) {
            if (budget.max <= 300) {
                return {
                    items: [{name: 'ã‚«ãƒ¬ãƒ¼ãƒ©ã‚¤ã‚¹', price: 200, icon: 'ğŸ›'}],
                    total: 200,
                    comment: 'å®šç•ªã‚«ãƒ¬ãƒ¼ã§é–“é•ã„ãªã—ï¼'
                };
            } else {
                return {
                    items: [
                        {name: 'ãŠé­šãƒ—ãƒ¬ãƒ¼ãƒˆ', price: 200, icon: 'ğŸŸ'},
                        {name: 'ã”é£¯ï¼ˆä¸­ï¼‰', price: 90, icon: 'ğŸš'},
                        {name: 'å‘³å™Œæ±', price: 60, icon: 'ğŸ²'}
                    ],
                    total: 350,
                    comment: 'ãƒãƒ©ãƒ³ã‚¹è‰¯ã„å®šé£Ÿã‚¹ã‚¿ã‚¤ãƒ«ï¼'
                };
            }
        }

        function displaySuggestion(suggestion) {
            const menuItems = document.getElementById('menu-items');
            const commentText = document.getElementById('comment-text');
            
            menuItems.innerHTML = '';
            
            suggestion.items.forEach(item => {
                const menuItem = document.createElement('div');
                menuItem.className = 'menu-item';
                menuItem.innerHTML = `
                    <div class="menu-name">${item.icon} ${item.name}</div>
                    <div class="menu-price">${item.price}å††</div>
                `;
                menuItems.appendChild(menuItem);
            });
            
            // åˆè¨ˆã‚’è¿½åŠ 
            const totalItem = document.createElement('div');
            totalItem.className = 'menu-item';
            totalItem.innerHTML = `
                <div class="menu-name">ğŸ’° åˆè¨ˆé‡‘é¡</div>
                <div class="menu-price">${suggestion.total}å††</div>
            `;
            menuItems.appendChild(totalItem);
            
            commentText.textContent = `ğŸ’¬ ${suggestion.comment}`;
        }

        function displayFinalDecision() {
            if (!currentSuggestion) return;
            
            const finalMenuItems = document.getElementById('final-menu-items');
            const finalCommentText = document.getElementById('final-comment-text');
            
            finalMenuItems.innerHTML = '';
            
            currentSuggestion.items.forEach(item => {
                const menuItem = document.createElement('div');
                menuItem.className = 'menu-item';
                menuItem.innerHTML = `
                    <div class="menu-name">${item.icon} ${item.name}</div>
                    <div class="menu-price">${item.price}å††</div>
                `;
                finalMenuItems.appendChild(menuItem);
            });
            
            // åˆè¨ˆã‚’è¿½åŠ 
            const totalItem = document.createElement('div');
            totalItem.className = 'menu-item';
            totalItem.innerHTML = `
                <div class="menu-name">ğŸ’° åˆè¨ˆé‡‘é¡</div>
                <div class="menu-price">${currentSuggestion.total}å††</div>
            `;
            finalMenuItems.appendChild(totalItem);
            
            finalCommentText.textContent = `ğŸ’¬ ${currentSuggestion.comment}`;
        }

        function handleCrowdStatus(status) {
            if (status === 'crowded') {
                generateSuggestion(true); // æ··é›‘ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é¿ã‘ã¦å†ææ¡ˆ
            } else {
                generateSuggestion(false, true); // ç©ºã„ã¦ã„ã‚‹å ´åˆã¯ãƒ©ãƒ¼ãƒ¡ãƒ³ã‚’å„ªå…ˆã—ã¦å†ææ¡ˆ
            }
        }

        function finalDecision() {
            displayFinalDecision();
            showFinalScreen();
        }

        function showResultScreen() {
            document.getElementById('selection-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'block';
            document.getElementById('final-screen').style.display = 'none';
        }

        function showFinalScreen() {
            document.getElementById('selection-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'none';
            document.getElementById('final-screen').style.display = 'block';
        }

        function goBack() {
            document.getElementById('selection-screen').style.display = 'block';
            document.getElementById('result-screen').style.display = 'none';
            document.getElementById('final-screen').style.display = 'none';
        }

        function restart() {
            // é¸æŠçŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
            selections = {budget: null, hunger: null, mood: null};
            
            // ãƒœã‚¿ãƒ³ã®é¸æŠçŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
            document.querySelectorAll('.choice-btn, .optional-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // ææ¡ˆãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
            document.getElementById('submit-btn').disabled = true;
            
            // æœ€åˆã®ç”»é¢ã‚’è¡¨ç¤º
            goBack();
        }
    </script>
</body>
</html>